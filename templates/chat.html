<html>
	<head>
		<title>Chat</title>
		<style>
			input{display:block;}
			ul{list-style:none;}
		</style>
	</head>
	<body>
		<ul id="messages"></ul>
		<form id="chatbox">
			<img src="{{.UserData.avatar_url}}" style="width: 20px; vertical-align: middle; margin: 1px 4px 1px 0px;">
			{{.UserData.name}}</br>
			<textarea></textarea>
			<input type="submit" value="Send"></input>
			or <a href="/logout">sign out</a>
		</form>
		<script src="//cdnjscn.b0.upaiyun.com/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
	    <script>
	      $(function(){
	        var socket = null;
	        var msgBox = $("#chatbox textarea");
	        var messages = $("#messages");
	        $("#chatbox").submit(function(){
	           if (!msgBox.val()) return false;
	           if (!socket) {
	             alert("Error: There is no socket connection.");
	             return false;
	           }
	           socket.send(JSON.stringify({"Message": msgBox.val()}));
	           msgBox.val("");
	           return false;
	        });
	
	        if(!window["WebSocket"]){
	          alert("Error: Your browser does not support websockets.")
	        }else{
	          socket = new WebSocket("ws://{{.Host}}/room");
	          socket.onclose = function() {
	            alert("Connection has been closed.");
	          }
	          socket.onmessage = function(e){
				var msg = eval("("+e.data+")");
	            messages.append(
			    	$("<li>").append(
						$("<img>").css({
							width:20,
							verticalAlign:"middle",
							margin:"1px 4px 1px 0"
						}).attr("src", msg.AvatarURL),
						$("<strong>").text(msg.Name + ": "),
						$("<span>").text(msg.Message)
				));
	          }
	        }
	      });
	    </script>
	</body>
</html>